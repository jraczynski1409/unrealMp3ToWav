<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Konwerter MP3 na WAV</title>
  </head>
  <body>
    <input type="file" id="mp3FileInput" accept=".mp3">
    <button onclick="convertMP3toWAV()">Konwertuj</button>

    <script>
      function convertMP3toWAV() {
        const mp3FileInput = document.getElementById('mp3FileInput');
        const file = mp3FileInput.files[0];

        if (file) {
          const reader = new FileReader();

          reader.onload = function(e) {
            const mp3Data = e.target.result;
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioContext.decodeAudioData(mp3Data, function(decodedData) {
              const wavData = convertBufferToWav(decodedData);

              const blob = new Blob([wavData], { type: 'audio/wav' });
              const url = window.URL.createObjectURL(blob);

              const downloadLink = document.createElement('a');
              downloadLink.href = url;
              downloadLink.download = file.name.replace('.mp3', '.wav');
              downloadLink.click();
            });
          };

          reader.readAsArrayBuffer(file);
        }
      }

      function convertBufferToWav(buffer) {
        const numberOfChannels = 1;
        const sampleRate = buffer.sampleRate;
        const bitsPerSample = 16;

        const bufferLength = buffer.length * numberOfChannels;
        const wavData = new ArrayBuffer(44 + bufferLength * bitsPerSample / 8);
        const view = new DataView(wavData);

        writeString(view, 0, 'RIFF');
        view.setUint32(4, 36 + bufferLength * bitsPerSample / 8, true);
        writeString(view, 8, 'WAVE');
        writeString(view, 12, 'fmt ');
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true);
        view.setUint16(22, numberOfChannels, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * numberOfChannels * bitsPerSample / 8, true);
        view.setUint16(32, numberOfChannels * bitsPerSample / 8, true);
        view.setUint16(34, bitsPerSample, true);
        writeString(view, 36, 'data');
        view.setUint32(40, bufferLength * bitsPerSample / 8, true);

        const offset = 44;
        for (let i = 0; i < bufferLength; i++) {
          const s = Math.max(-1, Math.min(1, buffer.getChannelData(0)[i]));
          view.setInt16(offset + i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
        }

        return wavData;
      }

      function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
          view.setUint8(offset + i, string.charCodeAt(i));
        }
      }
    </script>
  </body>
</html>
